# 权限控制机制

由于用户和项目之间的多对多关系和财务数据对安全性的高要求，需要设计更加科学的权限控制机制，保护数据的安全。

## 基本概念

* User：存储在用户表中，注册时仅提供邮箱即可，没有激活邮箱的用户不能登录，单个用户可以创建公司，也可以被邀请加入其他公司；
* Company：存储在公司信息表中，有且仅有1个Owner，但是可能有多个不同角色的成员；
* Member：用户和公司的关联表，指定角色，用户ID和公司ID构成唯一联合索引；

## 角色列表

* Owner：创建者，可以干任何事情，包括删除公司；
* Writer：可以写数据的人，除了删除公司之外，什么都能干；
* Reader：只能查看数据的人，除了浏览数据，什么都不能干；

## 执行流程

* 用户注册时，自动创建1个公司，并且创建1条Member数据，将用户和公司关联，角色设置为Owner；
* 用户添加成员时，首先自动创建1个未激活的用户，然后创建用户、公司、角色的关联，然后给这个用户发送邮件，让用户激活；
* 用户每次访问时，在passport的用户反序列化回调中，根据当前的用户和用户选择的公司调出用户的角色，根据角色加载响应的配置；

